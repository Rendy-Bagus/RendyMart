<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RenzzMart — Masuk / Daftar</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="auth-page">
    <div class="auth-card">
      <div class="brand">
        <img src="logo.png" alt="logo" class="logo" onerror="this.style.display='none'">
        <h1>RenzzMart</h1>
        <p class="muted">Daftar atau masuk untuk mulai berbelanja</p>
      </div>

      <div class="tabs">
        <button id="tabLogin" class="tab active">Login</button>
        <button id="tabRegister" class="tab">Daftar</button>
      </div>

      <div id="loginBox" class="form">
        <input id="loginId" placeholder="Email atau Username" />
        <input id="loginPass" type="password" placeholder="Password" />
        <button id="btnLogin" class="btn">Masuk</button>
        <div class="muted small" style="margin-top:10px">Atau coba sebagai <button id="guestBtn" class="link">Guest</button></div>
      </div>

      <div id="registerBox" class="form hidden">
        <input id="regName" placeholder="Nama tampil" />
        <input id="regUser" placeholder="Username" />
        <input id="regEmail" placeholder="Email" />
        <input id="regPass" type="password" placeholder="Password (min 6)" />
        <input id="regConfirm" type="password" placeholder="Konfirmasi password" />
        <label class="small muted"><input id="isAdmin" type="checkbox"> Buat admin (demo)</label>
        <button id="btnRegister" class="btn teal">Daftar</button>
      </div>

      <div id="msg" class="muted small" style="margin-top:12px"></div>
    </div>

    <footer class="auth-footer muted">RenzzMart v4.0 — Demo. Data tersimpan di browser (localStorage).</footer>
  </main>

  <script src="script.js"></script>
  <script>
    // Wire UI (uses RenzzAuth from script.js)
    (async ()=>{
      await window.RenzzAuth.init();

      const $ = id => document.getElementById(id);
      const tabLogin = $('tabLogin'), tabRegister = $('tabRegister');
      const loginBox = $('loginBox'), registerBox = $('registerBox');
      const msg = $('msg');

      tabLogin.addEventListener('click', ()=>{ tabLogin.classList.add('active'); tabRegister.classList.remove('active'); loginBox.classList.remove('hidden'); registerBox.classList.add('hidden'); msg.textContent=''; });
      tabRegister.addEventListener('click', ()=>{ tabRegister.classList.add('active'); tabLogin.classList.remove('active'); registerBox.classList.remove('hidden'); loginBox.classList.add('hidden'); msg.textContent=''; });

      $('btnLogin').addEventListener('click', async ()=>{
        msg.textContent = 'Memproses...';
        const id = $('loginId').value.trim(), pw = $('loginPass').value;
        const res = await window.RenzzAuth.login(id, pw);
        if(res.success){ msg.textContent = 'Login berhasil. Mengarahkan...'; setTimeout(()=> location.href='store.html',500); }
        else msg.textContent = 'Login gagal: ' + res.error;
      });

      $('btnRegister').addEventListener('click', async ()=>{
        msg.textContent = 'Mendaftar...';
        const payload = { name: $('regName').value.trim(), username: $('regUser').value.trim(), email: $('regEmail').value.trim(), password: $('regPass').value, confirm: $('regConfirm').value, isAdmin: $('isAdmin').checked };
        const r = await window.RenzzAuth.register(payload);
        if(r.success){ msg.textContent = 'Akun dibuat. Silakan login.'; tabLogin.click(); }
        else msg.textContent = 'Daftar gagal: ' + r.error;
      });

      $('guestBtn').addEventListener('click', async ()=>{
        await window.RenzzAuth.ensureGuest();
        location.href = 'store.html';
      });
    })();
  </script>
</body>
</html>
